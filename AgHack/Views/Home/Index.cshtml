@section Styles{
    <style>
         .leaflet-interactive {
            outline: none !important; /* 禁用點擊時的框框 */
        }

        .leaflet-container {
            cursor: default !important; /* 將鼠標樣式設置為默認 */
        }

        #historyRecordModal .modal-dialog {
            max-width: 80%; /* 寬度占 80% */
            height: 80%; /* 高度占 80% */
        }

        #historyRecordModal .modal-content {
            height: 100%; /* 讓內容填滿高度 */
        }
    </style>
}

<div class="bg-light h-100">
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- 左側地圖區域 -->
            <div class="col-md-8 p-3">
                <div class="card h-100 shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-map me-2"></i>地圖</h4>
                    </div>
                    <div id="Map" class="card-body p-0 position-relative">
                        <!-- 地圖容器，RWD 高度由 CSS 控制 -->
                    </div>
                </div>
            </div>

            <!-- 右側區域 -->
            <div class="col-md-4 p-3 d-flex flex-column" style="height: 100%;">
                <!-- 數據分析區 -->
                <div style="flex: 0 0 60%; overflow: hidden;">
                    <div class="card h-100 shadow d-flex flex-column">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>數據分析</h5>
                        </div>
                        <div class="card-body" style="overflow-y: auto;">
                            <!-- 數據內容將動態插入到這裡 -->
                            <div id="data-content"></div>
                        </div>
                    </div>
                </div>

                <!-- AI 對話區 -->
                <div style="flex: 0 0 40%; overflow: hidden; margin-top: 1rem;">
                    <div class="card h-100 shadow d-flex flex-column">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fas fa-comments me-2"></i>AI 對話</h5>
                        </div>
                        <div class="card-body" style="overflow-y: auto;">
                            <!-- 對話內容將動態插入到這裡 -->
                            <div id="chat-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Large Modal -->
<div class="modal fade" id="historyRecordModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="historyRecordModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="historyRecordModalLabel">歷史數據</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div id="history-content" class="modal-body">
        <!-- Modal Content Goes Here -->
        @* <p>這裡是歷史數據的內容區域。</p> *@
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
      </div>
    </div>
  </div>
</div>


@section Scripts{   
    <script src="https://unpkg.com/shpjs@latest/dist/shp.min.js"></script>
    <script src="~/js/leaflet/config.js"></script>
    <script src="~/js/leaflet/layers/basinlaye.js"></script>
    <script src="~/js/leaflet/layers/wqstlayer.js"></script>
    <script src="~/js/leaflet/layers/ugstlayer.js"></script>
    <script>

        // 建立 baseLayers 物件
        const baseLayers = {};
        baseLayerConfigs.forEach(cfg => {
            baseLayers[cfg.name] = cfg.layer;
        });

        // 初始化地圖，預設第一個底圖
        var map = L.map('Map', {
            center: mapConfig.center,
            zoom: mapConfig.zoom,
            minZoom: mapConfig.minZoom,
            maxZoom: mapConfig.maxZoom,
            maxBounds: mapConfig.maxBounds,
            layers: [baseLayerConfigs[0].layer],
        });

        // 移除雙擊事件的監聽器(原ZoomIn功能)
        map.off('dblclick');

        var layerControl = L.control.layers(baseLayers, {}).addTo(map);

        // 添加比例尺控制項
        L.control.scale({
            position: 'bottomleft', // 設置比例尺顯示在地圖左下角
            metric: true,          // 顯示公制單位（公里、米）
            imperial: false        // 不顯示英制單位（英里、英尺）
        }).addTo(map);

        // 建立圖層 Pane 可設定 zIndex 建立圖層顯示順序
        map.createPane('basinPane');
        map.getPane('basinPane').style.zIndex = 400; 

        map.createPane('wqPane');
        map.getPane('wqPane').style.zIndex = 500; 

        map.createPane('ugPane');
        map.getPane('ugPane').style.zIndex = 500; 

        // 載入圖層
        LoadBasinLayer();
        LoadWQStLayer();
        LoadUGStLayer();

        //  modal 關閉時清空modal內容
        const historyRecordModal = document.getElementById('historyRecordModal');
        historyRecordModal.addEventListener('hidden.bs.modal', function () {
          const modalBody = historyRecordModal.querySelector('#history-content');
          modalBody.innerHTML = '';
        });
    </script>
}